<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>四柱八字</title>
<script src="jquery.min.js"></script>
<script src="calendar.js"></script>
<style>
input {
  font-size: 1em;
}
.date span {
  display: block;
}
</style>
</head>
<body>
生日：
<input type="radio" name="src" class="solar" checked="checked"/>公历
<input type="radio" name="src" class="lunar"/>农历
<span><input type="checkbox" name="leap" class="leap"/>润月</span>
<br/>
<input type="input" class="year" size="4"/>年
<input type="input" class="month" size="2"/>月
<input type="input" class="day" size="2"/>日
<input type="input" class="hour" size="2"/>时
<br/>
<p class="date"></p>
<div class="history"></div>

<script>
var now = new Date();
$('.year').val(now.getFullYear());
$('.month').val(now.getMonth()+1);
$('.day').val(now.getDate());
$('.hour').val(now.getHours());
$('.leap').parent().hide();

$('input').change(function(){
  if($('.lunar')[0].checked)
    $('.leap').parent().show();
  else
    $('.leap').parent().hide();
  let src = $('input[name="src"]:checked'),
    year = $('.year').val(),
    month = $('.month').val(),
    day = $('.day').val(),
    hour = $('.hour').val(),
    leap = $('.leap')[0].checked;
  if(src.hasClass('solar')) {
    var cal = calendar.solar2lunar(year, month, day, hour);
    var source = '公历';
  } else {
    var cal = calendar.lunar2solar(year, month, day, hour, leap);
    var source = '农历';
  }
  if(cal === -1) $('.date').text('日期选择不正确');
  else {
    var is_leap = leap ? '(润月)' : '';
    var prefix = `<span>${source} ${year}年${month}月${day}日${hour}时${is_leap}</span>`;
    $('.date').html(`${prefix}${cal.gzYear}年${cal.gzMonth}月${cal.gzDay}日${cal.gzHour}时`);
    $('.history').append($('.date')[0].outerHTML);
  }
});
var cal = calendar.solar2lunar();
$('.date').html(`<span>现在是</span>${cal.gzYear}年${cal.gzMonth}月${cal.gzDay}日${cal.gzHour}时`);
</script>

</body>
</html>
